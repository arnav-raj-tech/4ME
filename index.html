<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>4ME Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f8ff;
      color: #111;
    }
    header {
      background: white;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    header h1 {
      color: #1e66ff;
      margin: 0;
    }
    button {
      background: #1e66ff;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #144fd1;
    }
    .container {
      padding: 20px;
    }
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
    }
    .card {
      background: white;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
    }
    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<header>
  <h1>4ME</h1>
  <button onclick="openLogin()">Admin Login</button>
</header>

<div class="container">

  <!-- ADMIN LOGIN -->
  <div id="loginBox" class="hidden">
    <h2>Admin Login</h2>
    <input id="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <!-- PRODUCTS -->
  <h2>Products</h2>
  <div class="products" id="productList"></div>

  <!-- CART -->
  <h2>Checkout (COD)</h2>
  <input id="custName" placeholder="Full Name" />
  <input id="custPhone" placeholder="Phone Number" />
  <textarea id="custAddress" placeholder="Full Address"></textarea>
  <button onclick="placeOrder()">Place Order</button>

</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from
    "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from
    "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAzJmA3ESY7rcVyB9WP2fyAPoX-WDfsWtY",
    authDomain: "me-ad192.firebaseapp.com",
    projectId: "me-ad192",
    storageBucket: "me-ad192.firebasestorage.app",
    messagingSenderId: "496094300165",
    appId: "1:496094300165:web:a3be380ffa7e2abb14346c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const ADMIN_EMAIL = "arnavraj3112@gmail.com";
  let cart = [];

  // ---------- AUTH ----------
  window.openLogin = () => {
    document.getElementById("loginBox").classList.toggle("hidden");
  };

  window.login = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    await signInWithEmailAndPassword(auth, email, password);
  };

  onAuthStateChanged(auth, user => {
    if (user && user.email === ADMIN_EMAIL) {
      window.location.href = "admin.html";
    }
  });

  // ---------- PRODUCTS ----------
  async function loadProducts() {
    const snap = await getDocs(collection(db, "products"));
    const list = document.getElementById("productList");
    list.innerHTML = "";

    snap.forEach(doc => {
      const p = doc.data();
      list.innerHTML += `
        <div class="card">
          <img src="${p.imageUrl}">
          <h4>${p.name}</h4>
          <p>â‚¹${p.price}</p>
          <button onclick='addToCart(${JSON.stringify(p)})'>Add</button>
        </div>
      `;
    });
  }

  window.addToCart = (product) => {
    cart.push(product);
    alert("Added to cart");
  };

  // ---------- ORDER ----------
  window.placeOrder = async () => {
    const name = custName.value.trim();
    const phone = custPhone.value.trim();
    const address = custAddress.value.trim();

    if (!name || !phone || !address || cart.length === 0) {
      alert("Fill all details and add products");
      return;
    }

    await addDoc(collection(db, "orders"), {
      items: cart,
      customer: { name, phone, address },
      payment: "COD",
      status: "pending",
      createdAt: serverTimestamp()
    });

    alert("Order placed successfully");
    cart = [];
  };

  loadProducts();
</script>

</body>
</html>
